{% extends 'blog/base.html' %}
{% block content %}
  <div class="row justify-content-center">
    <div class="narrowcol">
      <h3><a class="column-header" href="">Calendar</a></h3>
      <div class="post">
        <p>calendar here</p>
      </div>
    </div>
      <div class="widecol">
        <div class="">
          <h2><a class="column-header" href="{% url 'post_list'%}">News</a></h2>
            <div class="post">
              {% for post in posts|slice:":3" %}
              <div class="post-container">
                <h1><a href="{% url 'post_detail' pk=post.pk %}">{{ post.title }}</a></h1>
                <div class="date">
                  <p>published: {{ post.published_date }}</p>
                </div>
                <p class="post-body">{{ post.text|truncatewords:50|linebreaksbr }}
                  {% if post.text|wordcount > 50 %}
                    <a href="{% url 'post_detail' pk=post.pk %}">read more</a>
                  {% endif %}
                </p>

                  {% if post.comments.count == 1 %}
                    <a href="{% url 'post_detail' pk=post.pk %}">1 comment</a>
                  {% else %}
                    <a href="{% url 'post_detail' pk=post.pk %}">{{ post.comments.count }} comments</a>
                  {% endif %}

              </div>
            {% endfor %}
            <a class="pull-right" href="{% url 'post_list' %}">View All</a>
            </div>
          </div>

          <div class="">
            <h2><a class="column-header" href="{% url 'forum_list' %}">Forum</a></h2>
            <div class="post">
              {% for forumpost in forumposts|slice:":3" %}
              <div class="post-container">
                <h4><a href="{% url 'forum_detail' pk=forumpost.pk %}">{{ forumpost.title }}</a></h4>
                <div class="date">
                  <p>started by {{ forumpost.author }} on {{ forumpost.published_date }}</p>
                </div>
                <p class="post-body">{{ forumpost.text|truncatewords:50|linebreaksbr }}
                  {% if forumpost.text|wordcount > 50 %}
                    <a href="{% url 'forum_detail' pk=forumpost.pk %}">read more</a>
                  {% endif %}
                  </p>
                  {% if forumpost.forumcomments.count == 1 %}

                    <a href="{% url 'forum_detail' pk=forumpost.pk %}">1 reply
                  {% else %}
                    <a href="{% url 'forum_detail' pk=forumpost.pk %}">{{ forumpost.forumcomments.count }} replies
                  {% endif %}
                  {% if forumpost.forumcomments.count > 0 %}
                    {% with forumpost.forumcomments.all|dictsortreversed:"created_date"|first as first_comment %}
                      |  Last reply by {{ first_comment.author }} on {{ first_comment.created_date }}
                    {% endwith %}
                  {% endif %}
                </a>
              </div>
              {% endfor %}
              <a class="pull-right" href="{% url 'post_list' %}">View All</a>
            </div>
          </div>
        </div>

  </div>
{% endblock %}
